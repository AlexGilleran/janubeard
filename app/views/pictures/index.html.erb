<html>
<body>
 <div id="container">
    <h1>Snapshot Emotions Detector</h1>
      <video autoplay></video> 
        <canvas></canvas>
          <button>Take snapshot</button>
</div>
</body>
</html>
  

  <script type="text/javascript">
	
    'use strict';
    $('canvas').hide()
    // Put variables in global scope to make them available to the browser console.
    var video = document.querySelector('video');
    var canvas = window.canvas = document.querySelector('canvas');
    canvas.width = 480;
    canvas.height = 360;
    var shutter = new Audio();
    shutter.autoplay = false;
    shutter.src = navigator.userAgent.match(/Firefox/) ? '/assets/shutter.ogg' : '/assets/shutter.mp3';
    var button = document.querySelector('button');

    button.onclick = function() {
      $('video').hide()
      $('canvas').show()
      shutter.play();
      $( "html" ).addClass( "loading" );
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      canvas.getContext('2d').
      drawImage(video, 0, 0, canvas.width, canvas.height);
      var dataURL = canvas.toDataURL("image/png");
      console.log("url : " + dataURL); 

      $.ajax({
        url: "/pictures",
        method: 'POST',
        data: {
          picture: {
            image: dataURL 
          }
        }
      }).done(function(d) {
        console.log('data :' + d);
        console.log("success!");
      }).fail(function(a){
        console.log(a)
      }).always(function(c){
        console.log("ajax done")
      });

    };


    var constraints = {
      audio: false,
      video: true
    };

    function successCallback(stream) {
      window.stream = stream; // make stream available to browser console
      video.srcObject = stream;

    }

    function errorCallback(error) {
      console.log('navigator.getUserMedia error: ', error);
    }

    navigator.getUserMedia(constraints, successCallback, errorCallback);
  
</script>



